<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="_dev/test2.css"/>
    <script type="text/javascript" src="static/js/min/jquery.min.js"></script>
    <script>
        $(function () {
            var selector = '[id^="diigo"]',
                i = 0,        // счётчик итераций
                r = 0,        // счётчик удалений
                m = 0,        // счётчик пост-удалений
                limit = 1000, // лимит итераций
                intv = setInterval(function () { // процедура удаления
                    var objects = document.querySelectorAll(selector);
                    if (objects.length) {
                        for (var d in objects) {
                            if (typeof(objects[d]) == 'object') {
                                objects[d].remove();
                                //console.log('Удаление: '+objects[d].id);
                                r++; // инкременировать счётчик удалений
                            }
                        }
                    }
                    // инкременировать счётчик пост-удалений
                    if (r) m++;
                    // если пост-удалений БОЛЬШЕ, чем реальных удалений, пора заканчивать
                    if (m > r) clearInterval(intv);
                    i++;
                    if (i > limit) {
                        clearInterval(intv);
                        console.log('%cвыполнено максимальное (' + limit + ') количество итераций...', 'color: orange');
                    }
                }, 100);

            function getTop() {
                var ids = {
                    /**
                     * Создать набор перемещающихся слоёв.
                     * Для каждого указать собственный коэффициент перемещения
                     * @coeff   - величина перемещения слоя по вертикали
                     * @top     - начальная позиция отступа сверху
                     */
                    fixed1: {
                        coeff: 1,
                        top: false
                    },
                    fixed2: {
                        coeff: 0.75,
                        top: false
                    }
                };
                // сохранить значения отступов сверху для плавающих слоёв
                for (var id in ids) {
                    ids[id].top = document.getElementById(id).offsetTop;
                }
                //console.dir(ids);
                // перегрузить функцию. Далее будем только получать инициализированные значения.
                getTop = function () {
                    return ids;
                };
            }

            getTop();

            var getMaxScroll = function () {
                    // получить максимальную позицию прокрутки окна
                            // 1632             //  984
                    return $('body').height() - window.outerHeight;
                },
                posRatio, // соотношение текущей прокрутки окна к максимальной
                maxScrollTop = getMaxScroll(),
                prlx,
                makeParallax = function (event, calcMax) {
                    prlx = getTop();
                    //console.dir(getTop());
                    for (var layer_id in prlx) {
                        if (calcMax) maxScrollTop = getMaxScroll();
                        posRatio = $(window).scrollTop() / maxScrollTop * prlx[layer_id].coeff;
                        document.getElementById(layer_id).style.top = ($('body').height() + prlx[layer_id].top) * posRatio + 'px';
                        console.groupCollapsed('event: ' + event.type + ', posRatio: ' + posRatio);// 0.37
                            console.log('widow.scrollTop: ' + $(window).scrollTop());
                            console.log('maxScrollTop: ' + maxScrollTop);
                            console.log('coeff: ' + prlx[layer_id].coeff);
                            console.groupCollapsed('layer current top: ' + document.getElementById(layer_id).style.top);
                                console.log('body.height: ' + $('body').height());    // 999
                                console.log('layer.top: ' + prlx[layer_id].top);      // 0
                            console.groupEnd();
                        console.groupEnd();
                    } //console.log('scrollTop: '+$(window).scrollTop()+', offset.top: '+$(fix1).css('top'));
                };
            $(document).on('scroll', function (event) {
                makeParallax(event);
            });
            $(window).on('resize', function (event) {
                makeParallax(event, true);
            });
        });
    </script>

</head>
<body>
<div id="page" style="position: relative; overflow: hidden">
    <main>
        <p>Далеко-далеко за словесными горами в стране гласных и согласных живут рыбные тексты. Вдали от всех живут они
            в буквенных домах на берегу Семантика большого языкового океана. Маленький ручеек Даль журчит по всей стране
            и обеспечивает ее всеми необходимыми правилами.</p>

        <p>Эта парадигматическая страна, в которой жаренные члены предложения залетают прямо в рот. Даже всемогущая
            пунктуация не имеет власти над рыбными текстами, ведущими безорфографичный образ жизни. Однажды одна
            маленькая строчка рыбного текста по имени Lorem ipsum решила выйти в большой мир грамматики.</p>

        <p>Великий Оксмокс предупреждал ее о злых запятых, диких знаках вопроса и коварных точках с запятой, но текст не
            дал сбить себя с толку. Он собрал семь своих заглавных букв, подпоясал инициал за пояс и пустился в
            дорогу.</p>

        <p>Взобравшись на первую вершину курсивных гор, бросил он последний взгляд назад, на силуэт своего родного
            города Буквоград, на заголовок деревни Алфавит и на подзаголовок своего переулка Строчка. Грустный
            реторический вопрос скатился по его щеке и он продолжил свой путь. По дороге встретил текст рукопись. Она
            предупредила его: «В моей стране все переписывается по несколько раз. Единственное, что от меня осталось,
            это приставка «и». Возвращайся ты лучше в свою безопасную страну». Не послушавшись рукописи, наш текст
            продолжил свой путь. Вскоре ему повстречался коварный составитель!</p>

        <p>Далеко-далеко за словесными горами в стране гласных и согласных живут рыбные тексты. Вдали от всех живут они
            в буквенных домах на берегу Семантика большого языкового океана. Маленький ручеек Даль журчит по всей стране
            и обеспечивает ее всеми необходимыми правилами.</p>

        <p>Эта парадигматическая страна, в которой жаренные члены предложения залетают прямо в рот. Даже всемогущая
            пунктуация не имеет власти над рыбными текстами, ведущими безорфографичный образ жизни. Однажды одна
            маленькая строчка рыбного текста по имени Lorem ipsum решила выйти в большой мир грамматики.</p>

        <p>Великий Оксмокс предупреждал ее о злых запятых, диких знаках вопроса и коварных точках с запятой, но текст не
            дал сбить себя с толку. Он собрал семь своих заглавных букв, подпоясал инициал за пояс и пустился в
            дорогу.</p>

        <p>Взобравшись на первую вершину курсивных гор, бросил он последний взгляд назад, на силуэт своего родного
            города Буквоград, на заголовок деревни Алфавит и на подзаголовок своего переулка Строчка. Грустный
            реторический вопрос скатился по его щеке и он продолжил свой путь. По дороге встретил текст рукопись. Она
            предупредила его: «В моей стране все переписывается по несколько раз. Единственное, что от меня осталось,
            это приставка «и». Возвращайся ты лучше в свою безопасную страну». Не послушавшись рукописи, наш текст
            продолжил свой путь. Вскоре ему повстречался коварный составитель!</p>

        <p>Далеко-далеко за словесными горами в стране гласных и согласных живут рыбные тексты. Вдали от всех живут они
            в буквенных домах на берегу Семантика большого языкового океана. Маленький ручеек Даль журчит по всей стране
            и обеспечивает ее всеми необходимыми правилами.</p>

        <p>Эта парадигматическая страна, в которой жаренные члены предложения залетают прямо в рот. Даже всемогущая
            пунктуация не имеет власти над рыбными текстами, ведущими безорфографичный образ жизни. Однажды одна
            маленькая строчка рыбного текста по имени Lorem ipsum решила выйти в большой мир грамматики.</p>

        <p>Великий Оксмокс предупреждал ее о злых запятых, диких знаках вопроса и коварных точках с запятой, но текст не
            дал сбить себя с толку. Он собрал семь своих заглавных букв, подпоясал инициал за пояс и пустился в
            дорогу.</p>

        <p>Взобравшись на первую вершину курсивных гор, бросил он последний взгляд назад, на силуэт своего родного
            города Буквоград, на заголовок деревни Алфавит и на подзаголовок своего переулка Строчка. Грустный
            реторический вопрос скатился по его щеке и он продолжил свой путь. По дороге встретил текст рукопись. Она
            предупредила его: «В моей стране все переписывается по несколько раз. Единственное, что от меня осталось,
            это приставка «и». Возвращайся ты лучше в свою безопасную страну». Не послушавшись рукописи, наш текст
            продолжил свой путь. Вскоре ему повстречался коварный составитель!</p>

        <p>Далеко-далеко за словесными горами в стране гласных и согласных живут рыбные тексты. Вдали от всех живут они
            в буквенных домах на берегу Семантика большого языкового океана. Маленький ручеек Даль журчит по всей стране
            и обеспечивает ее всеми необходимыми правилами.</p>

        <p>Эта парадигматическая страна, в которой жаренные члены предложения залетают прямо в рот. Даже всемогущая
            пунктуация не имеет власти над рыбными текстами, ведущими безорфографичный образ жизни. Однажды одна
            маленькая строчка рыбного текста по имени Lorem ipsum решила выйти в большой мир грамматики.</p>

        <p>Великий Оксмокс предупреждал ее о злых запятых, диких знаках вопроса и коварных точках с запятой, но текст не
            дал сбить себя с толку. Он собрал семь своих заглавных букв, подпоясал инициал за пояс и пустился в
            дорогу.</p>

        <p>Взобравшись на первую вершину курсивных гор, бросил он последний взгляд назад, на силуэт своего родного
            города Буквоград, на заголовок деревни Алфавит и на подзаголовок своего переулка Строчка. Грустный
            реторический вопрос скатился по его щеке и он продолжил свой путь. По дороге встретил текст рукопись. Она
            предупредила его: «В моей стране все переписывается по несколько раз. Единственное, что от меня осталось,
            это приставка «и». Возвращайся ты лучше в свою безопасную страну». Не послушавшись рукописи, наш текст
            продолжил свой путь. Вскоре ему повстречался коварный составитель!</p>
        <!--<iframe src="http://frame.plans24.ru/s1171/" height="400" width="100%" frameborder="0" scrolling="no"></iframe>
        <script type="text/javascript" src="iframe.js"></script>-->
    </main>
    <div class="parallax" id="fixed1" style="background-color: orange; padding: 10px;">Hello! I am fixed.</div>
    <div class="parallax" id="fixed2" style="background-color: pink; padding: 10px;">Hi! I am fixed too.</div>
</div>
</body>
</html>