/*
 colorplus: a CSS color picker
 @author  Levente Hunyadi
 @version 1.5.0
 @remarks Copyright (C) 2010-2011 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/sigplus
*/
(function(){function a(b){return"colorplus-"+b}var d={};d.DropDownList=new Class({Implements:Events,initialize:function(b,e){var c=this,h=(new Element("div",{"class":a("list")})).adopt(new Element("span",{"class":a(e)}),new Element("span",{"class":a("list")}),(new Element("ul",{"class":a("list")})).adopt(b.map(function(b){return(new Element("li")).adopt(b).addEvent("click",function(){c.fireEvent("change",this)})}))).addEvents({click:function(){if(!h.hasClass(a("disabled")))return h.toggleClass(a("open")),
!1},mouseleave:function(){h.removeClass(a("open"))}});h.getElements("*").set("unselectable","on");c._control=h},toElement:function(){return this._control},setEnabled:function(b){this._control.toggleClass(a("disabled"),!b)}});d.Dialog=new Class({initialize:function(){var b=(new Element("div",{"class":a("dialog")})).adopt((new Element("div",{"class":a("titlebar")})).adopt(this._title=new Element("div",{"class":a("title")}),new Element("div",{"class":a("close"),events:{click:this.hide.bind(this)}})),
(new Element("div",{"class":a("container")})).adopt(this._content=new Element("div",{"class":a("content")})),new Element("div",{"class":a("resize")})).inject(document.body);window.Drag&&(new Drag(b,{handle:b.getElement(".colorplus-title")}),new Drag(b,{handle:b.getElement(".colorplus-resize"),modifiers:{x:"width",y:"height"}}));this._dialog=b;this.center();b.addClass(a("hidden"))},toElement:function(){return this._dialog},show:function(){return this._dialog.removeClass(a("hidden"))},hide:function(){return this._dialog.addClass(a("hidden"))},
center:function(){var b=this._dialog.getSize(),e=window.getSize();this._dialog.setStyles({left:(e.x-b.x)/2,top:(e.y-b.y)/2})},resize:function(){this._content.getParent().setStyle("width","auto");this._dialog.setStyles({width:this._content.getSize().x+2,height:this._content.getSize().y+2+28});this._content.getParent().setStyle("width","100%");this.center();return this},adopt:function(b){this._content.adopt(b);return this}});d.EditorDialog=new Class({Extends:d.Dialog,initialize:function(b){this.parent();
this.boundcontrol=b}});Array.implement("hsbToHex",function(){return this.hsbToRgb().rgbToHex()});var l={AliceBlue:15792383,AntiqueWhite:16444375,Aqua:65535,Aquamarine:8388564,Azure:15794175,Beige:16119260,Bisque:16770244,Black:0,BlanchedAlmond:16772045,Blue:255,BlueViolet:9055202,Brown:10824234,BurlyWood:14596231,CadetBlue:6266528,Chartreuse:8388352,Chocolate:13789470,Coral:16744272,CornflowerBlue:6591981,Cornsilk:16775388,Crimson:14423100,Cyan:65535,DarkBlue:139,DarkCyan:35723,DarkGoldenRod:12092939,
DarkGray:11119017,DarkGrey:11119017,DarkGreen:25600,DarkKhaki:12433259,DarkMagenta:9109643,DarkOliveGreen:5597999,DarkOrange:16747520,DarkOrchid:10040012,DarkRed:9109504,DarkSalmon:15308410,DarkSeaGreen:9419919,DarkSlateBlue:4734347,DarkSlateGray:3100495,DarkSlateGrey:3100495,DarkTurquoise:52945,DarkViolet:9699539,DeepPink:16716947,DeepSkyBlue:49151,DimGray:6908265,DimGrey:6908265,DodgerBlue:2003199,FireBrick:11674146,FloralWhite:16775920,ForestGreen:2263842,Fuchsia:16711935,Gainsboro:14474460,GhostWhite:16316671,
Gold:16766720,GoldenRod:14329120,Gray:8421504,Grey:8421504,Green:32768,GreenYellow:11403055,HoneyDew:15794160,HotPink:16738740,IndianRed:13458524,Indigo:4915330,Ivory:16777200,Khaki:15787660,Lavender:15132410,LavenderBlush:16773365,LawnGreen:8190976,LemonChiffon:16775885,LightBlue:11393254,LightCoral:15761536,LightCyan:14745599,LightGoldenRodYellow:16448210,LightGray:13882323,LightGrey:13882323,LightGreen:9498256,LightPink:16758465,LightSalmon:16752762,LightSeaGreen:2142890,LightSkyBlue:8900346,LightSlateGray:7833753,
LightSlateGrey:7833753,LightSteelBlue:11584734,LightYellow:16777184,Lime:65280,LimeGreen:3329330,Linen:16445670,Magenta:16711935,Maroon:8388608,MediumAquaMarine:6737322,MediumBlue:205,MediumOrchid:12211667,MediumPurple:9662680,MediumSeaGreen:3978097,MediumSlateBlue:8087790,MediumSpringGreen:64154,MediumTurquoise:4772300,MediumVioletRed:13047173,MidnightBlue:1644912,MintCream:16121850,MistyRose:16770273,Moccasin:16770229,NavajoWhite:16768685,Navy:128,OldLace:16643558,Olive:8421376,OliveDrab:7048739,
Orange:16753920,OrangeRed:16729344,Orchid:14315734,PaleGoldenRod:15657130,PaleGreen:10025880,PaleTurquoise:11529966,PaleVioletRed:14184595,PapayaWhip:16773077,PeachPuff:16767673,Peru:13468991,Pink:16761035,Plum:14524637,PowderBlue:11591910,Purple:8388736,Red:16711680,RosyBrown:12357519,RoyalBlue:4286945,SaddleBrown:9127187,Salmon:16416882,SandyBrown:16032864,SeaGreen:3050327,SeaShell:16774638,Sienna:10506797,Silver:12632256,SkyBlue:8900331,SlateBlue:6970061,SlateGray:7372944,SlateGrey:7372944,Snow:16775930,
SpringGreen:65407,SteelBlue:4620980,Tan:13808780,Teal:32896,Thistle:14204888,Tomato:16737095,Turquoise:4251856,Violet:15631086,Wheat:16113331,White:16777215,WhiteSmoke:16119285,Yellow:16776960,YellowGreen:10145074};d.RGBControl=new Class({Implements:Events,initialize:function(){var b=this,e=new Element("input",{type:"text",size:4});b._control=(new Element("div")).adopt([e.clone(),e.clone(),e.clone()]);b._control.getChildren().addEvents({change:function(){b.fireEvent("change",b._control.getChildren().map(function(b){return $pick(Number.from(b.get("value")),
0).limit(0,255)}).rgbToHex())}})},toElement:function(){return this._control},update:function(b){this._control.getChildren().each(function(e,c){var a=""+b[c];e.get("value")!=a&&e.set("value",b[c])})}});d.ColorPicker=new Class({Implements:Events,_hsb:[0,100,100],_mode:!0,initialize:function(b){function e(b,e){var c=b.getPosition();return Array.from(b.getContext("2d").getImageData(e.page.x-c.x,e.page.y-c.y,1,1).data)}var c=this;c._mode=b;(new Element("div",{"class":a("colors-picker")})).adopt(c._line=
new Element("canvas",{"class":a("colors-bar"),events:{click:function(a){a=e(c._line,a);b?(c._hsb[0]=a.rgbToHsb()[0],c.update()):c.fireEvent("change",a.rgbToHex())}}}),c._plane=new Element("canvas",{"class":a("colors-plane"),events:{click:function(a){a=e(c._plane,a);b?c.fireEvent("change",a.rgbToHex()):(a=a.rgbToHsb(),c._hsb=[a[0],a[1],c._hsb[2]],c.update())}}}));c._setCanvasSize(c._line);c._setCanvasSize(c._plane);if(b){var h=c._line,g=h.height,f=h.getContext("2d");f.save();for(var d=0;d<360;d++){var i=
[d,100,100].hsbToHex();f.strokeStyle=i;f.fillStyle=i;f.fillRect(0,(g*d/360).toInt(),h.width,g)}}else{i=c._plane;h=i.height;g=i.width;f=i.getContext("2d");f.save();for(d=0;d<360;d++)for(var j=0;j<=100;j++)i=[d,j,100].hsbToHex(),f.strokeStyle=i,f.fillStyle=i,f.fillRect((g*d/359).toInt(),(h*j/100).toInt(),g,h)}f.restore();c.update()},toElement:function(){return this._line.getParent()},_setCanvasSize:function(b){b.height=b.getStyle("height").toInt();b.width=b.getStyle("width").toInt()},update:function(b){b=
this._hsb=b?b.rgbToHsb():this._hsb;if(this._mode){var a=this._plane;this._setCanvasSize(a);var c=a.height,d=a.width,g=a.getContext("2d");g.save();for(var f=0;f<=100;f++)a=g.createLinearGradient(0,0,d,0),a.addColorStop(0,[b[0],0,f].hsbToHex()),a.addColorStop(1,[b[0],100,f].hsbToHex()),g.fillStyle=a,g.fillRect(0,c*f/100,d,c)}else a=this._line,this._setCanvasSize(a),c=a.height,d=a.width,g=a.getContext("2d"),g.save(),a=g.createLinearGradient(0,0,d,c),a.addColorStop(0,[b[0],b[1],0].hsbToHex()),a.addColorStop(1,
[b[0],b[1],100].hsbToHex()),g.fillStyle=a,g.fillRect(0,0,d,c);g.restore()}});d.ColorsDialog=new Class({Extends:d.EditorDialog,initialize:function(b){function e(a){if(a&&(a=/^#/.test(a)?a:a.rgbToHex())){var b=a.hexToRgb(!0);g.update(b);f.set("value",a);k.setStyle("background-color",a);h&&(i.update(b),j.update(b))}}var c=this;c.parent(b);c._title.adopt(new Element("span",{"class":a("colors-title")}));var h=(new Element("canvas")).getContext,g,f,k,i,j;b=[[new Element("span",{"class":a("colors-named")}),
(new d.DropDownList(Object.keys(l).map(function(b){var c=l[b].toString(16);return[new Element("div",{"class":a("colors-sample"),styles:{"background-color":"#"+"000000".substr(c.length)+c}}),new Element("span",{html:b})]}))).addEvent("change",function(a){e(a.getElement(".colorplus-colors-sample").getStyle("background-color"))})],[new Element("span",{"class":a("colors-rgb")}),g=(new d.RGBControl).addEvent("change",e)],[new Element("span",{"class":a("colors-hex")}),f=(new Element("input",{type:"text",
size:8})).addEvent("change",function(){var a=f.get("value");/^#([0-9a-f]{3}){1,2}$/i.test(a)&&e(a)})],[new Element("span",{"class":a("colors-sample")}),k=new Element("div",{"class":a("colors-sample")})]];window.Color&&h&&b.push([new Element("span",{"class":a("colors-picker")}),[i=(new d.ColorPicker(!0)).addEvent("change",e),j=(new d.ColorPicker(!1)).addEvent("change",e)]]);c._content.adopt((new Element("table")).adopt(b.map(function(a){return(new Element("tr")).adopt(a.map(function(a){return(new Element("td")).adopt(a)}))})),
new Element("button",{type:"button",html:"OK",events:{click:function(){c.boundcontrol.set("value",k.getStyle("background-color"));c.hide()}}}))}});d.bind=function(a,e){var c=new d.ColorsDialog(a);e&&e.addEvent("click",function(){c.show();c.resize()})};window.colorplus=d})(document.id);
