/*
 slideplus image rotator
 @author  Levente Hunyadi
 @version 1.5.0
 @remarks Copyright (C) 2011 Levente Hunyadi
 @see     http://hunyadi.info.hu/projects/slideplus
*/
(function(A){function C(b){var a;do{a=[0,0,0,0];var d;if(d=window.getComputedStyle(b,null).getPropertyValue("background-color").match(/^rgba?\((.*)\)$/))a=d[1].split(",").map(parseFloat),a.push(1),a=a.slice(0,4);b=b.getParent()}while(b&&0==a[3]);return a}function k(b){return b.map(function(a){return"slideplus-"+a}).join(" ")}function u(b){return".slideplus-"+b}Object.append(Element.NativeEvents,{dragstart:2});Elements.implement({at:function(b){var a=this.length;return this[(b%a+a)%a]}});var D=new Class({initialize:function(b){this._icon=
(new Element("div",{"class":"loadplus"})).adopt([0,1,2,3,4,5,6,7].map(function(a){return new Element("div",{"class":"loadplus-bar"+a})})).inject(b);this._images=b.getElements("img").each(function(a){a.setProperty("data-src",a.getProperty("src")).removeProperty("src").setStyle("visibility","hidden")})},load:function(){var b=this;b._images.each(function(a){function d(){a.removeProperty("data-src").setProperty("src",e).setStyle("visibility","visible");b._images.erase(a).pick()||b._icon.destroy()}var e=
a.getProperty("data-src");e&&A(new Image).addEvent("load",d).set("src",e)})}}),r=new Class({Implements:Options,options:{size:{rows:1,cols:3},step:"page",loop:!1,random:!1,orientation:"horizontal",layout:"natural",horzalign:"center",vertalign:"center",navigation:["over","bottom"],trigger:"click",links:!0,counter:!0,edges:"none",protection:!1,duration:800,transition:"sine",delay:!1,scrollspeed:200,scrollfactor:5,preloader:!0},_index:0,initialize:function(b,a,d){function e(a){function b(a){return("0"+
a.toString(16)).slice(-2)}return"#"+b(Math.floor(255*a[3]))+b(a[0])+b(a[1])+b(a[2])}function f(a,b,c){a.each(function(a){a.adopt(new Element("span",{"class":k(["navbutton",b]),html:c}))})}if(b){var c=this;c.setOptions(a);a=c.options;var s=c._list=(c._gallery=b).getElement("ul,ol");if(s){var m=b.getElements("img");m.each(function(a){a.setStyles({width:a.getProperty("width")+"px",height:a.getProperty("height")+"px"})});var l=c._allitems=s.getChildren("li");a.random&&l.sort(function(){return Math.random()-
0.5});2>l.length&&(a.loop=!1);var q=(new Element("div",{"class":"slideplus"})).inject(b).grab(s.removeClass("slideplus"));l.each(function(b){b.addEvent("click",function(){$$([l,c._curitems].flatten()).removeClass(k(["active"]));$$(b,this).addClass(k(["active"]))});b.adopt((new Element("div",{"class":k(["align","horizontal-"+a.horzalign,"vertical-"+a.vertalign])})).adopt(b.getChildren()))});var p=a.size.rows,h=a.size.cols;if(0<p&&0<h){var y=0,t=0;m.concat(l).each(function(a){a=a.getDimensions({computeSize:!0,
styles:["margin","border","padding"]});y=Math.max(y,a.totalWidth);t=Math.max(t,a.totalHeight)});$$(s,q).setStyles({width:h*(c._maxwidth=y),height:p*(c._maxheight=t)});l.setStyles({width:y,height:t})}else a.counter=!1;if("fade"==a.edges){q.adopt(new Element("div",{"class":k(["edge","edge-start",a.orientation])}),new Element("div",{"class":k(["edge","edge-end",a.orientation])}));var n=C(b),B=[n[0],n[1],n[2],0];q.getElements(u("edge")).each(function(a){["filter","background-image"].each(function(b){var c=
a.getStyle(b);c&&(c=c.replace(/#fffefefe/g,e(n)).replace(/#00fefefe/g,e(B)),c=c.replace(/#fefefe|rgb\(254,\s*254,\s*254\)|black/g,"rgba("+n.join(",")+")").replace(/rgba\(254,\s*254,\s*254,\s*1\)|transparent/g,"rgba("+B.join(",")+")"),a.setStyle(b,c))})})}var v=a.navigation,m=v.clone().erase("over");m.each(function(a){(new Element("div",{"class":k(["navbar"])})).setStyle("width",q.getStyle("width")).inject(b,a)});var g=c._quickaccess=b.getElements(u("navbar"));if(v.contains("over")){var w="vertical"==
a.orientation,x=s.getSize(),v=w?"vertical":"horizontal",x=120>(w?x.x:x.y)?"small":"large";q.adopt(new Element("div",{"class":k(["prev",v,x])}),new Element("div",{"class":k(["next",v,x])}))}m.length&&1<l.length&&(f(g,"prev","&lt;"),f(g,"next","&gt;"),0<p&&(0<h&&p*h>2*l.length)&&(f(g,"first","|&lt;"),f(g,"last","&gt;|")));a.links&&g.each(function(b){var d=new Element("div",{"class":k(["paging"])}),e="vertical"==a.orientation?h:p,g=l.length,f="page"==a.step?((g-1)/(p*h)).floor()+1:g;1<f&&f.times(function(b){d.adopt(new Element("span",
{html:b+1,events:{click:function(){c._index="page"==a.step?b*p*h:b.min(g-(0<g%e?g%e:e)-(p*h-e));c._layout()}}}))});b.adopt(d)});c._paging=b.getElements(u("paging"));l.dispose();a.preloader&&(c._populous()&&16>p*h)&&l.each(function(a){a.store("preloader",new D(a))});l.each(function(b,d){var e=b.getElement("a");e&&e.href==window.location.href&&(c._index=c._index="page"==a.step?(d/(p*h)).floor()*p*h:d,b.addClass(k(["active"])))});c._advance(0);m=c._buttons("prev");g=c._buttons("next");if("mouseover"==
a.trigger)c._stopScroll(),m.addEvents({mouseover:function(){c._startScroll(-1)},mouseout:function(){c._stopScroll()}}),g.addEvents({mouseover:function(){c._startScroll(1)},mouseout:function(){c._stopScroll()}}),$$([m,g].flatten()).addEvents({mousedown:function(){c._accelerateScroll()},mouseup:function(){c._decelerateScroll()}});else{m.addEvent("click",c.prev.bind(c));g.addEvent("click",c.next.bind(c));var r,w="vertical"==a.orientation;q.addEvent("touchstart",function(a){a.stop();a=a.changedTouches[0];
r=w?a.pageY:a.pageX});q.addEvent("touchend",function(a){a.stop();a=a.changedTouches[0];a=w?a.pageY:a.pageX;50<=a-r?c.prev():50<=r-a&&c.next()})}c._buttons("first").addEvent("click",c.first.bind(c));c._buttons("last").addEvent("click",c.last.bind(c));a.protection&&document.addEvents({contextmenu:function(a){return!s.contains(a.target)},dragstart:function(a){return!s.contains(a.target)}});if(a.delay){var z=!1;q.addEvents({mouseover:function(){c._clearTimeout()},mouseout:function(){z||c._setTimeout()}});
d&&d.addEvents({open:function(){z=!0;c._clearTimeout()},close:function(){z=!1;c._setTimeout()}})}}}},prev:function(){this._slide(-1)},next:function(){this._slide(1)},first:function(){this._index=0;this._layout()},last:function(){var b=this.options,a=b.size.rows,d=b.size.cols,e=this._allitems.length;this._index="page"==b.step?((e-1)/(a*d)).floor()*a*d:e-1;this._layout()},_setTimeout:function(){var b=this,a=b.options.delay;a&&!b._intervalID&&(b._intervalID=window.setTimeout(function(){b._intervalID=
!1;!b._gallery||b._gallery.offsetHeight||b._gallery.offsetWidth?b._slide(1):b._setTimeout()},a))},_clearTimeout:function(){this._intervalID&&(window.clearTimeout(this._intervalID),this._intervalID=!1)},_buttons:function(b){return this._gallery.getElements(u(b))},_populous:function(){var b=this.options,a=b.size.rows,d=b.size.cols;return this._allitems.length>=a*d+2*("page"==b.step?a*d:"vertical"==b.orientation?d:a)},_layout:function(){function b(a,c,d){a=a.cloneEvents(c,d).getChildren();c=c.getChildren();
for(var e=0;e<a.length;e++)b(a[e],c[e],d)}var a=this,d=a.options,e=d.size.rows,f=d.size.cols,c=a._maxwidth,s=a._maxheight,m=a._allitems.length,l="page"==d.step;a._clearTimeout();var q=a._curitems=$$([]),p="vertical"==d.orientation,h=p?f:e,r=a._index-(l?e*f:h),h=a._index+e*f+(l?e*f:h);for(d.loop||(h=h.min(m));r<h;r++){var t=a._allitems.at(r),n=t.retrieve("preloader");n&&n.load();a._populous()?q.push(t):(n=(n=window.jQuery)?A(n(t).clone(!0)[0]):t.clone(),b(n,t),q.push(n))}a._list.getChildren().each(function(a){a.removeEvents(a.retrieve(k(["events"])))});
a._list.empty();q.each(function(b,h){var g=p;if(l){var m=d.layout;"row"==m&&(g=!0);"column"==m&&(g=!1)}g?(g=h%f*c,m=(h/f).toInt()*s-(l?e:1)*s):(g=(h/e).toInt()*c-(l?f:1)*c,m=h%e*s);a._list.adopt(b.setStyles({left:g,top:m}));var n=new Fx.Morph(b,{link:"cancel"});n.set(u("inactive"));g={mouseenter:function(){n.start(u("active"))},mouseleave:function(){n.start(u("inactive"))}};b.store(k(["events"]),g).addEvents(g)});a._buttons("prev").toggleClass(k(["hidden"]),!d.loop&&0>=a._index);a._buttons("next").toggleClass(k(["hidden"]),
!d.loop&&a._index>=m-(l?1:e*f));a._paging.each(function(b){var c=b.getChildren().removeClass(k(["active"])).at(a._index/(l?e*f:1));if(c){c.addClass(k(["active"]));var d=c.getPosition(b).x;(d+c.getSize().x>b.getSize().x||0>d)&&b.scrollTo(b.getScroll().x+d,0)}});a._setTimeout()},_advance:function(b){this._index+=b;this._layout();this._list.setStyles({left:0,top:0})},_increment:function(b){var a=this.options,d=a.size.rows,e=a.size.cols;return b*("page"==a.step?d*e:"vertical"==a.orientation?e:d)},_slide:function(b){var a=
this,d=a.options,e=d.size.rows,f=d.size.cols,c=a._increment(b);a._clearTimeout();if(d.loop||!(a._index+c>=a._allitems.length-("page"==d.step?0:e*f-1)||0>a._index+c))b=a._list.getChildren()[e*f].getPosition(),e=a._list.getChildren()[e*f+c].getPosition(),(new Fx.Morph(a._list,{link:"ignore",duration:d.duration,transition:d.transition,onComplete:function(){a._advance(c)}})).start({left:b.x-e.x,top:b.y-e.y})},_startScroll:function(b){var a=this,d=a.options,e=a._list,f="vertical"==d.orientation?"top":
"left",c=e.getStyle(f).toInt(),c=isNaN(c)?0:c;0==c&&0>b&&a._advance(a._increment(b));d=a._list.getChildren()[d.size.rows*d.size.cols].getSize();0==c&&0>b&&(c=-d.x,e.setStyle(f,c+"px"));var k=-d.x;a._scrolltimer=window.setInterval(function(){var d=!1;c-=b*a._scrollspeed;c<=k&&(c=k,d=!0);0<=c&&(c=0,d=!0);e.setStyle(f,c+"px");d&&(window.clearInterval(a._scrolltimer),a._scrolltimer=null,0<b&&a._advance(a._increment(b)),a._startScroll(b))},10)},_stopScroll:function(){this._decelerateScroll();this._scrolltimer&&
(window.clearInterval(this._scrolltimer),this._scrolltimer=null)},_accelerateScroll:function(){var b=this.options;this._scrollspeed=10*b.scrollspeed*b.scrollfactor/1E3},_decelerateScroll:function(){this._scrollspeed=10*this.options.scrollspeed/1E3}});r.autodiscover=function(b){window.addEvent("domready",function(){$$("ul.slideplus").each(function(a){new r((new Element("div")).wraps(a),b)});$$("noscript.slideplus").each(function(a){new r((new Element("div",{html:a.get("text")})).inject(a,"after"),
b);a.destroy()})})};window.slideplus=r})(document.id);
