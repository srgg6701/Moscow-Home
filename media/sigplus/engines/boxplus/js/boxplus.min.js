(function(){/*
 boxplus: a versatile lightweight pop-up window engine for MooTools
 @author  Levente Hunyadi
 @version 1.5.0
 @remarks Copyright (C) 2009-2014 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/boxplus
*/
var g=!0,k=null,q=!1;
(function(r){function v(a){var b={};1<a.length&&a.substr(1).split("&").each(function(a){var c=a.indexOf("=");b[unescape(0<=c?a.substr(0,c):a)]=unescape(0<=c?a.substr(c+1):"")});return b}function t(a){a.retrieve("boxplus-href")||(a.store("boxplus-href",a.get("href")),a.set("href","javascript:void(0);"))}function w(a){var b=a.retrieve("boxplus-href");b&&(a.set("href",b),a.eliminate("boxplus-href"))}Object.append(Element.NativeEvents,{popstate:2,dragstart:2});var x=new Class({Implements:[Events,Options],
options:{theme:q,navigation:g,autocenter:g,autofit:g,duration:"short",transition:"sine",protection:g,scrollspeed:200,scrollfactor:5,width:800,height:600,thumb_width:60,thumb_height:60},O:"",i:k,B:k,C:k,M:0,initialize:function(a){function b(a,b,c){var d=new Element("div",{"class":"string"==typeof a?"boxplus-"+a:a.map(function(a){return"boxplus-"+a}).join(" ")});b&&d.set(b);for(var e=2;e<arguments.length;e++)d.adopt(arguments[e]);return d}function e(a){return new Element("span",{"class":"boxplus-"+
a})}function c(a,b,c){c||(c="click");d.h(a).addEvent(c,b.bind(d))}this.setOptions(a);var d=this;d.D();a=b("thumbs",{},new Element("ul"),b("rewind"),b("forward"));var h=b("caption",{},b("title"),b("text")),n=b("controls",{},b("prev"),b("next"),b("start"),b(["stop","unavailable"]),b("close"),b("download"),b("metadata"));d.da=b([],{id:"boxplus"},d.w=b(["background","hidden"]),d.c=b(["dialog","hidden"],{},b("progress"),b("sideways",{},a.clone(),n.clone(),h.clone()),b("title"),b("main",{},d.ca=b("center",
{},d.o=b(["viewer","hidden"],{},d.z=new Element("img"),b("prev"),b("next"),b("resizer",{},b("enlarge").addEvent("click",function(){d.R()}),b(["shrink","unavailable"]).addEvent("click",function(){d.R()})),d.Ja=a.clone(),d.t=new Element("iframe",{frameborder:0}),d.j=new Element("video",{autoplay:g,controls:g}),d.m=b("object"),d.f=b("content"),b("progress"))),b("bottom",{},a.clone(),n.clone(),h.clone())),b("lt"),b("t"),b("rt"),b("l"),b(["m","hidden"]),b("r"),b("lb"),b("b"),b("rb")),d.n=b(["dialog","hidden"],
{},d.pa=b("sideways",{},a.clone(),h.clone(),n.clone()),b("title"),b("main",{},d.La=b("center",{},d.G=b(["viewer","hidden"],{},d.sa=new Element("div"))),d.ua=b("bottom",{},a.clone(),h.clone(),n.clone()))),e("unknown-type"),e("not-found")).inject(document.body);"repeat"==d.da.getStyle("background-repeat")&&d.w.addEvent("click",function(){d.close()});d.A=function(a){return!d.options.protection||!d.o.getElements("*").contains(a.target)};d.X=function(a){if(!["input","textarea"].contains(r(a.target).get("tag"))&&
(a=[37,39,36,35,13,27].indexOf(a.code),a>=(d.options.navigation?0:4)))return[d.S,d.next,d.xa,d.Aa,d.R,d.close][a].bind(d)(),q};var f;d.Y=function(){window.clearTimeout(f);d.ha||(f=window.setTimeout(function(){d.F.bind(d)()},10))};var m;d.o.addEvent("touchstart",function(a){a.stop();m=a.changedTouches[0].pageX});d.o.addEvent("touchend",function(a){a.stop();a=a.changedTouches[0].pageX;50<=a-m?d.S():50<=m-a&&d.next()});d.o.addEvent("dblclick",d.close.bind(d));c("prev",d.S);c("next",d.next);c("start",
d.start);c("stop",d.stop);c("close",d.close);c("download",d.wa);c("metadata",d.Ka);c("rewind",d.Ia,"mouseover");c("rewind",d.qa,"mouseout");c("rewind",d.ba,"mousedown");c("rewind",d.D,"mouseup");c("forward",d.Ha,"mouseover");c("forward",d.qa,"mouseout");c("forward",d.ba,"mousedown");c("forward",d.D,"mouseup");d.l()},H:function(a){return Array.from(a).map(function(a){return a.replace(/\b([\w-]+)/g,".boxplus-$1")}).join(", ")},W:function(a){return this.c.getElement(this.H(a))},h:function(a){return this.c.getElements(this.H(a))},
V:function(a){return this.n.getElements(this.H(a))},v:function(a){return this.h(a).concat(this.V(a))},r:function(a,b,e){this.h(a)[e?"addClass":"removeClass"](b)},N:function(a,b,e){this.V(a)[e?"addClass":"removeClass"](b)},b:function(a,b){this.r(a,"boxplus-unavailable",!b)},s:function(a,b){this.r(a,"boxplus-unavailable",!b);this.N(a,"boxplus-unavailable",!b)},la:function(a,b){this.r(a,"boxplus-disabled",!b)},k:function(a,b){this.r(a,"boxplus-disabled",!b);this.N(a,"boxplus-disabled",!b)},a:function(a,
b){this.r(a,"boxplus-hidden",!b)},Oa:function(a,b){this.r(a,"boxplus-hidden",!b);this.N(a,"boxplus-hidden",!b)},U:function(a,b){for(var e in a)window[b?"addEvent":"removeEvent"](e,a[e])},d:function(a,b){this.fireEvent(a,b)},fa:function(a){return this.da.getElement(".boxplus-"+a).get("html")},show:function(a){this.setOptions(a);a=this.options;var b=a.theme;b&&$$("link[rel=stylesheet][title^=boxplus]").set("disabled",g).filter('[title="boxplus-'+b+'"]').set("disabled",q);this.la(["prev","next","start",
"stop"],a.navigation);this.a("controls",q);this.a("bottom",q);this.a("sideways",q);this.P(this.c);$$([this.w,this.c]).removeClass("boxplus-hidden");this.w.fade("hide").fade("in");this.U({contextmenu:this.A,dragstart:this.A,keydown:this.X,resize:this.Y},g)},Q:function(){this.U({contextmenu:this.A,dragstart:this.A,keydown:this.X,resize:this.Y},q);this.w.fade("out");$$([this.w,this.c]).addClass("boxplus-hidden")},close:function(){var a=this;a.l();a.F(function(){a.d("close")})},xa:function(){this.d("first")},
S:function(){this.d("previous")},next:function(){this.d("next")},Aa:function(){this.d("last")},start:function(){this.d("start")},stop:function(){this.d("stop")},R:function(){this.h("shrink").toggleClass("boxplus-unavailable");this.h("enlarge").toggleClass("boxplus-unavailable");this.$();this.F()},Ia:function(){this.T(-1)},Ha:function(){this.T(1)},T:function(a){function b(){var b=g,d=g;h-=a*e.M;h<=f&&(h=f,b=q);0<=h&&(h=0,d=q);p===b||e.a("forward",p=b);m===d||e.a("rewind",m=d);c.setStyle("left",h+"px")}
var e=this,c=e.h("thumbs").getElement("ul"),d=e.Ja.getElement("ul"),h=d.getStyle("left").toInt(),h=isNaN(h)?0:h,f=e.o.getSize().x-d.getSize().x,p,m;e.a("forward",g);e.a("rewind",g);b();a&&(e.C=window.setInterval(b,10))},qa:function(){this.D();this.C&&(window.clearInterval(this.C),this.C=k)},ba:function(){this.M=10*this.options.scrollspeed*this.options.scrollfactor/1E3},D:function(){this.M=10*this.options.scrollspeed/1E3},wa:function(){window.location.href=this.O},oa:function(a){a=!a;this.a("resizer",
a);this.a("thumbs",a);this.a("viewer prev",a);this.a("viewer next",a);var b=$$([this.z,this.j,this.m,this.t]);a?(b.removeClass("boxplus-hidden"),this.f.addClass("boxplus-hidden")):(b.addClass("boxplus-hidden"),this.f.removeClass("boxplus-hidden"))},Ka:function(){this.oa(!this.za())},za:function(){return!this.f.hasClass("boxplus-hidden")},Ea:function(a,b,e){this.l();if(a){this.i={width:a.width,height:a.height};this.z.set("src",a.src).set(this.i).removeClass("boxplus-unavailable");this.O=b;this.b("download",
b);if(e){switch(typeof e){case "string":this.f.set("html",e);break;default:(e=r(e))&&this.f.adopt(e.clone())}this.f.removeClass("boxplus-unavailable")}this.b("metadata",e)}},ja:function(a){this.l();this.a("resizer",q);this.a("thumbs",q);this.a("viewer prev",q);this.a("viewer next",q);this.f.adopt(a.clone()).removeClass("boxplus-unavailable").removeClass("boxplus-hidden");this.i={width:this.options.width,height:this.options.height}},ka:function(a){a=v(a.search);this.i=a={width:a.width?a.width.toInt():
this.options.width,height:a.height?a.height.toInt():this.options.height}},na:function(a,b){this.j.set(b).set("src",a).setStyles(b).removeClass("boxplus-unavailable").adopt(new Element("source",{src:a}))},Fa:function(a){this.l();this.ka(a);var b=this.i,e=a.href;a=a.pathname;if(/\.(ogg|webM)$/i.test(a))this.na(e,b);else if(this.m.setStyles(b).removeClass("boxplus-unavailable"),/\.(pdf|mov)$/i.test(a)){var c,d,h={src:e};/\.pdf$/i.test(a)?(c="CA8A9780-280D-11CF-A24D-444553540000",d="application/pdf"):
/\.mov$/i.test(a)?(c="02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",d="video/quicktime"):/\.mpe?g/i.test(a)&&(c="22d6f312-b0f6-11d0-94ab-0080c74c7e95",d="video/mpeg");a=function(a){var b="",c;for(c in a)b+=" "+c+'="'+a[c]+'"';return b};this.m.innerHTML='<object id="boxplus-object"'+a(Object.merge({classid:"clsid:"+c},b))+">"+function(a){var b="",c;for(c in a)b+='<param name="'+c+'" value="'+a[c]+'" />';return b}(h)+"\x3c!--[if lt IE 9]>\x3c!--\x3e<object"+a(Object.merge({},{type:d,data:e},b))+">"+f.fa("unknown-type").replace("%s",
d)+"</object>\x3c!--<![endif]--\x3e</object>"}else c=Object.merge({params:{allowFullScreen:g}},b),/\.swf$/i.test(a)?new Swiff(e,Object.merge({container:this.m},c)):(this.na(e,b),new Swiff(e,Object.merge({container:this.j},c)))},ma:function(a){this.l();this.ka(a);this.t.set({Ma:0,src:a.href}).setStyles(this.i).removeClass("boxplus-unavailable")},l:function(){$$([this.f,this.z,this.j,this.m,this.t]).addClass("boxplus-unavailable");this.f.empty();this.z.erase("src");!this.j.pause||this.j.pause();this.j.empty().erase("src");
this.m.empty();this.t.set("src","about:blank").erase("src");this.o.setStyles(this.i={width:150,height:150});this.O="";this.b("download",q);this.b("metadata",q);this.ia()},ia:function(a,b){this.v("title").set("html",a);this.v("text").set("html",b);this.s("title",a);this.s("text",b);this.s("caption",a||b)},Da:function(a){this.k("bottom",q);this.k("sideways",q);switch(a){case "bottom":this.k("bottom",g);break;case "sideways":this.k("sideways",g)}},Ga:function(a){this.k("thumbs",q);switch(a){case "inside":this.k("viewer thumbs",
g);break;case "outside":this.k("bottom thumbs",g),this.k("sideways thumbs",g)}},ta:function(a){var b=this,e=[b.options.thumb_width,"auto"].pick(),c=[b.options.thumb_height,"auto"].pick();b.v("thumbs").each(function(d){var h=d.getElement("ul");a.each(function(a){(new Element("li")).adopt(a.clone().setStyles({"max-width":e,"max-height":c}).addEvent("click",function(){var a=r(this).getParent();b.d("change",a.getParent().getChildren().indexOf(a))})).inject(h)})});b.s("thumbs",1<a.length)},va:function(){this.h("thumbs").each(function(a){a.getElement("ul").empty()})},
Ca:function(a){this.v("thumbs").each(function(b){b=b.getElement("ul").getElements("li");b.removeClass("boxplus-active");0<=a&&b[a]&&r(b[a]).addClass("boxplus-active")})},ga:function(){return this.j.get("src")||this.m.getChildren().length?q:this.W("shrink").hasClass("boxplus-unavailable")},ya:function(a){var b=window.getSize(),e=window.clientWidth,c=window.clientHeight,e=1<e?e:b.x,c=1<c?c:b.y;a=a.getSize();e=(0).max((e-a.x)/2);c=(0).max((c-a.y)/2);"fixed"!=this.c.getStyle("position")&&(a=window.getScroll(),
e+=a.x,c+=a.y);return{x:e,y:c}},P:function(a){a.setPosition(this.ya(a))},Ba:function(){this.P(this.n);this.c.set("morph",{duration:this.options.duration,link:"cancel"}).morph(this.n.getStyles(["left","top"]))},$:function(){var a=this.options.autocenter&&this.ga(),b=a?"fixed":"absolute",e=this.c.getStyle("position"),c=this.c.getPosition(),d=c.x,c=c.y;e!=b&&(e=window.getScroll(),a?(d-=e.x,c-=e.y):(d+=e.x,c+=e.y));this.c.setStyle("position",b);this.c.setPosition({x:d,y:c})},p:function(a){this.n.setStyle("display",
a?"block":"none")},F:function(a){function b(a,b){c.G.setStyles({width:a,height:b});return c.n.getSize()}function e(){return c.n.getStyles(["left","top","width","height"])}var c=this;c.ha=g;c.a("controls",q);c.a("bottom",q);c.a("sideways",q);c.a("viewer",q);var d=!c.z.get("src")&&!c.j.get("src")&&!c.m.getChildren().length&&!c.t.get("src");c.oa(d);c.a("thumbs",1<c.W("thumbs").getChildren().length);var h=c.i.width,f=c.i.height;c.p(g);c.G.setStyle("margin-right",c.pa.getSize().x);var p=window.getSize();
if(d){d=b(h,"auto");c.sa.empty();var m=c.f.getChildren();m.length&&c.sa.adopt(m);f=c.G.getSize().y;d=b(h,f);d=b(Math.min(p.x,d.x)-(d.x-h),Math.min(p.y,d.y)-(d.y-f));m.length&&c.f.adopt(m)}else{d=b(h,f);if((m=c.options.autofit&&(p.x<d.x||p.y<d.y))&&c.ga()){var l;if(1>(l=p.x/d.x))h*=l,f*=l,d=b(h,f);for(;1>(l=p.y/d.y);)h*=l,f*=l,d=b(h,f)}c.b("resizer",m)}c.$();c.P(c.n);c.s("bottom",q);c.s("sideways",q);c.ca.setStyle("height","100%");var h=e(),u={duration:c.options.duration,link:"cancel",transition:c.options.transition},
f=new Fx.Morph(c.c,Object.merge(u,{onComplete:function(){c.p(g);c.ca.setStyle("height","auto");var b=c.G.getStyles(["width","height"]);c.t.setStyles(b);c.o.setStyles(b);c.f.scrollTo(0,0);c.a("viewer",g);c.v("thumbs").each(function(a){var b=a.getElement("ul"),c=b.getElement(".boxplus-active");if(c){var d=a.getSize().x-c.getSize().x;a=b.getPosition(a);var c=c.getPosition(b).x,e=a.x+c;e>d&&(a.x=-c+d);0>e&&(a.x=-c);b.setPosition(a)}});c.T(0);a&&a();var d=e(),f=new Fx.Morph(c.c,Object.merge(u,{onComplete:function(){c.b("bottom",
g);c.b("sideways",g);c.h("thumbs").setStyle("max-width",b.width);c.a("controls",g);c.a("bottom",g);c.a("sideways",g);c.ha=q;c.p(g);c.Ba();c.p(q)}}));c.p(q);f.start(d)}}));c.p(q);f.start(h);c.ua.removeClass("boxplus-unavailable");c.pa.removeClass("boxplus-unavailable")},ra:function(a){var b=this.h("progress");this.B&&window.clearInterval(this.B);if(b.length&&a){var e=b[0].getStyle("background-position"),c=e?e.toInt():0;this.B=window.setInterval(function(){b.setStyle("background-position",(c=(c-32)%
384)+"px 0")},150)}else this.B=k;this.a("progress",a)}}),f;window.addEvent("domready",function(){f=new x});var s=new Class({Implements:[Events,Options],e:-1,g:$$([]),q:k,L:function(a){var b=a.getElement("img");return a.retrieve("title")||(b?b.getProperty("alt"):"")},K:function(a){return a.retrieve("summary")||a.getProperty("title")},I:function(a){return a.retrieve("download")},J:function(){},options:{slideshow:0,autostart:q,loop:q,captions:"bottom",thumbs:"inside",cloak:q},initialize:function(a,b){if(a){var e=
this,c,d=a.get("tag");if(a.each)if(d.every(function(a){return"a"==a}))c=a,e.e=0;else return;else if("a"==d)s.extenders.each(function(b){c=b.bind(e)(a)}),c||(d=a.get("rel"),c=$$(d&&d.test(/^boxplus\b(?!$)/)?'a[rel="'+d+'"]':a),e.e=c.indexOf(a));else if(/^[udo]l$/.test(d))c=$$(a.getChildren("li,dt").map(function(a){return a.getElement("a")}).filter(function(a){return a})),e.e=0<c.length?0:-1;else{e.Na(a.getElement("ul,ol,dl"),b);return}e.setOptions(b);b&&(e.L=[b.getTitle,e.L].pick(),e.K=[b.getText,
e.K].pick(),e.I=[b.getDownloadUrl,e.I].pick(),e.J=[b.getMetadata,e.J].pick());c.addEvent("click",function(){e.show.delay(1,e,this);return q});e.options.cloak&&c.each(t);e.g=c}},show:function(a){var b=this;a&&(b.e=(0).max(b.g.get("href").indexOf(a.get("href"))));f.Q();f.ra(g);f.Da(b.options.captions);f.Ga(b.options.thumbs);f.ta($$(b.g.map(function(a){if(a=[a.retrieve("thumb"),a.getElement("img")].pick()){var b=a.get("data-thumb");a=b?{src:b}:{src:a.get("src"),width:a.get("width"),height:a.get("height")};
return new Element("img",a)}return k})));var e="previous next first last start stop change close".split(" "),c=e.map(function(a){return b[a].bind(b)});b.ea=c.associate(e);b.aa(a.href);window.addEvent("popstate",b.close.bind(b));f.addEvents(b.ea);f.show(b.options);a=b.options.slideshow&&1<b.g.length;f.la("start",a);b.Z(b.e);a&&b.options.autostart&&b.start();b.d("open")},close:function(){f.l();f.removeEvents(this.ea);f.Q();for(f.va();"boxplus"==window.history.state;)window.history.go(-1);this.d("close")},
previous:function(){this.u(this.e-1)},next:function(){this.u(this.e+1)},first:function(){this.u(0)},last:function(){this.u(this.g.length-1)},change:function(a){this.u(a)},start:function(){this.q||(this.q=setTimeout(this.next.bind(this),this.options.slideshow));f.b("start",q);f.b("stop",g)},stop:function(){this.q&&(clearTimeout(this.q),this.q=k);f.b("stop",q);f.b("start",g)},u:function(a){if(a!=this.e&&(this.options.loop||0<=a&&a<this.g.length))this.Z(a),this.d("change")},d:function(a,b){this.fireEvent(a,
b)},aa:function(a){var b=window.history;if(b=b["boxplus"==b.state?"replaceState":"pushState"])try{b("boxplus","",a)}catch(e){}},Z:function(a){function b(){f.F(function(){f.ra(q);h||p||d.start()})}function e(a){f.ia(d.L(a),d.K(a))}function c(a,c){f.Ea(c,d.I(a),d.J(a));f.Ca(d.e);e(a);b()}var d=this,h=!d.q;d.stop();f.l();var n=d.g.length,p=a>=n-1;f.a("viewer",q);f.b("start",!p);var m=d.options.loop;f.b("prev",m&&1<n||0<a);f.b("next",m&&1<n||!p);if(0<n){d.e=(a+n)%n;var l=d.g[d.e];w(l);d.aa(l.href);a=
l.get("href");n=l.href;m=l.pathname;if(/^#/.test(a))switch(a=r(a.substr(1)),a.get("tag")){case "img":c(l,a);break;default:f.ja(a),b()}else/\.(txt|html?)$/i.test(m)&&l.host==window.location.host?(new Request.HTML({url:n,onSuccess:function(a){a=$$(a);f.ja(a);b()},onFailure:function(){alert(f.fa("not-found"));f.Q()}})).get():/\.(gif|jpe?g|png)$/i.test(m)?r(new Image).addEvent("load",function(){c(l,this)}).set("src",n):/youtube\.com$/.test(l.hostname)?(f.ma(l),e(l),b()):/\.(pdf|mov|mpe?g|ogg|swf|webM|wmv)$/i.test(m)||
/(viddler|vimeo)\.com$/.test(l.hostname)?(f.Fa(l),e(l),b()):"javascript:"!=l.protocol&&(f.ma(l),e(l),b());d.options.cloak&&t(l)}}});Object.append(window.boxplus=s,{extenders:[function(a){var b=this,e;if(Request.JSONP&&(e=a.href.match(/https?:\/\/picasaweb.google.com\/data\/feed\/(?:api|base)\/user\/([^\/?#]+)\/albumid\/([^\/?#]+)/)))return(new Request.JSONP({url:"http://picasaweb.google.com/data/feed/api/user/"+e[1]+"/albumid/"+e[2],data:{alt:"json",imgmax:800,kind:"photo",thumbsize:"64u"},onComplete:function(a){b.g=
$$([]);a.feed.entry.each(function(a){var c=a.media$group.media$thumbnail[0];b.g.include((new Element("a",{href:a.content.src,title:a.summary.$t})).adopt(new Element("img",{width:c.width,height:c.height,alt:a.title.$t,src:c.url})))});b.e=0}})).send(),$$(a)}],autodiscover:function(a,b){window.addEvent("domready",function(){var e=[];$$("a[rel^=boxplus]:not([rel=boxplus])").each(function(a){e.include(a.get("rel"))});e.each(function(a){new s($$('a[rel="'+a+'"]'),b)});$$("a[rel=boxplus]").each(function(a){new s(a,
b)});a||$$("a[href]:not([rel^=boxplus])").filter(function(a){return/\.(gif|jpe?g|png|swf)$/i.test(a.pathname)&&!/_(blank|parent|self|top)/.test(a.get("target"))}).each(function(a){new s(a,b)})})}})})(document.id);})();
